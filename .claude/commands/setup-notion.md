# 新規プロジェクト Notion ページ構築

新規プロジェクトの開始時に、Notion上にプロジェクト管理用のページ構造を自動生成します。

## 前提条件

- Notion MCPが利用可能であること
- プロジェクト基本情報データベースが存在すること
- 以下の構造定義ファイルが存在すること：
  - `99_プロジェクト全体/notion-structure.json`
  - `99_プロジェクト全体/notion-templates-mapping.json`

## 実行手順

### Step 1: プロジェクト基本情報の収集

まず、以下の情報をユーザーに確認してください：

```
【プロジェクト基本情報】
プロジェクト名:
顧客名:
契約金額: 万円
契約形態: (請負/準委任/ハイブリッド)
開始日: YYYY/MM/DD
終了予定日: YYYY/MM/DD
PM:
エンジニア:
営業:
リポジトリURL: (あれば)
```

### Step 2: 構造定義ファイルの読み込み

以下のファイルを読み込んでページ階層とテンプレート変換ルールを把握してください：

1. `99_プロジェクト全体/notion-structure.json` - ページ階層構造の定義
2. `99_プロジェクト全体/notion-templates-mapping.json` - Markdown→Notion変換ルール

**notion-structure.json の構造**:
- `title`: Notionページのタイトル
- `type`: `page` (通常ページ) または `database` (データベースページ)
- `icon`: ページアイコン (絵文字)
- `template`: テンプレート名（notion-templates-mapping.jsonで定義）
- `children`: 子ページの配列（再帰構造）

**notion-templates-mapping.json の構造**:
- `static_page`: 固定コンテンツのページ (テーブル、テキストなど)
- `database`: データベースページ (プロパティ定義を含む)
- `blocks`: Notionブロックの配列
- `properties`: データベースのプロパティ定義

### Step 3: Notion MCPでの操作実行

#### 3-1. プロジェクト基本情報DBにエントリ作成

Notion MCPの`create_page`ツールを使用して、プロジェクト基本情報データベースに新規エントリを作成してください。

作成するプロパティ：
- プロジェクト名 (title)
- 顧客名 (rich_text)
- 契約金額 (number)
- 契約形態 (select)
- 開始日 (date)
- 終了予定日 (date)
- フェーズ (status) - デフォルト値: "要求分析"
- PM (rich_text)
- エンジニア (rich_text)
- 営業 (rich_text)
- リポジトリURL (url)

#### 3-2. プロジェクトTOPページの作成

1. **TOPページ作成**
   - プロジェクト名をタイトルに設定
   - アイコン: 🏢
   - 親ページ: ワークスペースまたは指定された親ページ

2. **子ページの再帰的作成**
   - `notion-structure.json`の`children`配列を走査
   - 各ページを以下のルールで作成：
     - `type === "page"`: 通常ページとして作成し、テンプレートがあれば適用
     - `type === "database"`: データベースページとして作成し、プロパティ定義を適用
   - 子ページがあれば再帰的に処理を続ける

3. **テンプレート変換処理**
   - `notion-templates-mapping.json`のルールに従ってコンテンツを変換
   - 以下のブロックタイプをサポート：
     - `heading_1`, `heading_2`: 見出し
     - `table`: テーブル（ヘッダー + データ行）
     - `paragraph`: 段落
     - `bulleted_list_item`: 箇条書き
     - `callout`: コールアウト

#### 3-3. リンクドビューの設定

各管理DBのリンクドビューを作成し、以下のフィルタを設定してください：

- **議事録DB**: `プロジェクト = {このプロジェクト}`、ソート: 会議日 (降順)
- **質問管理DB**: `プロジェクト = {このプロジェクト}` かつ `ステータス ≠ Closed`
- **変更管理DB**: `プロジェクト = {このプロジェクト}` かつ `ステータス ≠ 完了`
- **リスク管理DB**: `プロジェクト = {このプロジェクト}` かつ `ステータス ≠ 解決済み`
- **進捗報告DB**: `プロジェクト = {このプロジェクト}`、ソート: 報告週 (降順)

### Step 4: 実行結果の確認

以下の項目をチェックしてユーザーに報告してください：

- [ ] プロジェクト基本情報DBにエントリが作成されたか
- [ ] プロジェクトTOPページが作成されたか
- [ ] 基本情報セクションに必要な情報が入力されているか
- [ ] 資料一覧のフォルダ構造が作成されたか
- [ ] 各管理DBのリンクドビューが正しく表示されているか
- [ ] リンクドビューのフィルタが適用されているか

## 注意事項

### Notion API制限への対応
- ページ作成は一度に最大100ブロックまで
- 複雑な構造の場合は、段階的に作成する
- リンクドビューは手動でフィルタ調整が必要な場合がある

### エラー処理
- データベースIDが見つからない場合は、ユーザーに確認を求める
- ページ作成に失敗した場合は、エラー内容を詳細に報告する
- テンプレート変換に失敗した場合は、該当箇所をスキップして続行する

## 関連ドキュメント

- [Notion DB構造設計](99_プロジェクト全体/Notion_DB構造設計.md)
- [Notion構造定義JSON](99_プロジェクト全体/notion-structure.json)
- [Notionテンプレートマッピング JSON](99_プロジェクト全体/notion-templates-mapping.json)
- [Notion構成](99_プロジェクト全体/Notion構成.md)
