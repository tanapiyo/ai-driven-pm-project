# Phase 3: 設計・開発準備（Design & Development Preparation）

## 概要

Phase 2で確定した要件定義をもとに、システムの詳細設計を行います。アーキテクチャ、データベース、API、画面、帳票、運用の各設計書を作成し、開発チームが実装できる状態にします。

## 期間

- **標準**: 1〜2ヶ月
- **ミーティング回数**: 設計レビュー3〜4回

## このフェーズで作成する成果物

1. **システム構成図**: システムアーキテクチャ、インフラ構成
2. **DB設計書**: ER図、テーブル定義、インデックス設計
3. **API設計書**: エンドポイント、リクエスト/レスポンス、認証方式
4. **画面設計書**: ワイヤーフレーム、画面項目定義、バリデーション
5. **帳票設計書**: 帳票レイアウト、出力項目、フォーマット
6. **運用設計書**: バックアップ、監視、障害対応、保守手順

## 設計の順序（重要）

設計は**依存関係**を考慮して以下の順序で進めます:

```
1. システム構成図 ← 全体の基盤
     ↓
2. DB設計 ← データモデルの確定
     ↓
3. API設計 ← バックエンドのインターフェース
     ↓
4. 画面設計 ← フロントエンドのUI/UX
     ↓
5. 帳票設計 ← 出力系の仕様
     ↓
6. 運用設計 ← 保守・運用の仕組み
```

## ワークフロー

### Step 1: システム構成図の作成

**目的**:
- システム全体のアーキテクチャを決定
- インフラ構成（クラウド/オンプレ、サーバー構成）を決定
- 技術スタック（言語、フレームワーク、ミドルウェア）を選定

**使用プロンプト**:
- [`システム構成図.md`](./プロンプト/システム構成図.md)

**使用テンプレート**:
- [`システム構成図.md`](./テンプレート/システム構成図.md)

**入力**:
- Phase 2の要件定義書、非機能要件

**レビューポイント**:
- [ ] 非機能要件（性能、可用性）を満たすアーキテクチャか
- [ ] スケーラビリティは考慮されているか
- [ ] セキュリティ要件を満たす構成か
- [ ] コスト効率は適切か

---

### Step 2: DB設計書の作成

**目的**:
- データモデルの設計（エンティティ、リレーション）
- 物理テーブル設計（カラム、型、制約）
- インデックス設計（パフォーマンス最適化）

**使用プロンプト**:
- [`DB設計.md`](./プロンプト/DB設計.md)

**使用テンプレート**:
- [`DB設計.md`](./テンプレート/DB設計.md)

**入力**:
- Phase 2の機能一覧、ユースケース、既存データ整理

**レビューポイント**:
- [ ] 正規化は適切か（過度な正規化/非正規化はないか）
- [ ] パフォーマンス要件を満たすインデックス設計か
- [ ] データ移行の考慮はされているか
- [ ] セキュリティ（暗号化、マスキング）は考慮されているか

---

### Step 3: API設計書の作成

**目的**:
- RESTful API（またはGraphQL）のエンドポイント設計
- リクエスト/レスポンスのスキーマ定義
- 認証・認可方式の決定

**使用プロンプト**:
- [`API設計.md`](./プロンプト/API設計.md)

**使用テンプレート**:
- [`API設計.md`](./テンプレート/API設計.md)

**入力**:
- Phase 2のユースケース、画面遷移、DB設計書

**レビューポイント**:
- [ ] RESTful原則に従っているか（適切なHTTPメソッド、ステータスコード）
- [ ] エラーハンドリングは統一されているか
- [ ] 認証・認可の仕組みは明確か
- [ ] バージョニング戦略は定義されているか

---

### Step 4: 画面設計書の作成

**目的**:
- ワイヤーフレーム/モックアップの作成
- 画面項目定義（入力項目、表示項目）
- バリデーションルールの定義

**使用プロンプト**:
- [`画面設計.md`](./プロンプト/画面設計.md)

**使用テンプレート**:
- [`画面設計.md`](./テンプレート/画面設計.md)

**入力**:
- Phase 2の画面遷移、ユースケース、DB設計書、API設計書

**レビューポイント**:
- [ ] ユーザビリティ（使いやすさ）は考慮されているか
- [ ] アクセシビリティ（WCAG準拠）は考慮されているか
- [ ] レスポンシブデザインは必要か
- [ ] 画面遷移図と整合しているか

---

### Step 5: 帳票設計書の作成

**目的**:
- 帳票レイアウトの設計（PDF、Excel、CSV等）
- 出力項目の定義
- 集計ロジックの定義

**使用プロンプト**:
- [`帳票設計.md`](./プロンプト/帳票設計.md)

**使用テンプレート**:
- [`帳票設計.md`](./テンプレート/帳票設計.md)

**入力**:
- Phase 2の機能一覧、既存帳票リスト、DB設計書

**レビューポイント**:
- [ ] 既存帳票との互換性は考慮されているか
- [ ] 帳票フォーマット（PDF/Excel/CSV）は適切か
- [ ] 大量データ出力時のパフォーマンスは考慮されているか
- [ ] 印刷レイアウトは実務に適しているか

---

### Step 6: 運用設計書の作成

**目的**:
- バックアップ・リストア手順の定義
- 監視項目・アラート設定の定義
- 障害対応手順の定義
- 保守・運用の手順書作成

**使用プロンプト**:
- [`運用設計.md`](./プロンプト/運用設計.md)

**使用テンプレート**:
- [`運用設計.md`](./テンプレート/運用設計.md)

**入力**:
- Phase 2の非機能要件、システム構成図

**レビューポイント**:
- [ ] バックアップ頻度・保持期間は適切か
- [ ] 監視項目は網羅的か（死活監視、性能監視、セキュリティ監視）
- [ ] 障害時の連絡フローは明確か
- [ ] 保守作業の手順は明確か

## プロンプト・テンプレート一覧

| 順序 | プロンプト名 | テンプレート名 | 目的 | 入力 |
|-----|------------|-------------|------|------|
| 1 | [システム構成図](./プロンプト/システム構成図.md) | [システム構成図](./テンプレート/システム構成図.md) | アーキテクチャ設計 | 要件定義書、非機能要件 |
| 2 | [DB設計](./プロンプト/DB設計.md) | [DB設計](./テンプレート/DB設計.md) | データモデル設計 | 機能一覧、ユースケース |
| 3 | [API設計](./プロンプト/API設計.md) | [API設計](./テンプレート/API設計.md) | API仕様設計 | ユースケース、DB設計 |
| 4 | [画面設計](./プロンプト/画面設計.md) | [画面設計](./テンプレート/画面設計.md) | UI/UX設計 | 画面遷移、API設計 |
| 5 | [帳票設計](./プロンプト/帳票設計.md) | [帳票設計](./テンプレート/帳票設計.md) | 帳票仕様設計 | 機能一覧、DB設計 |
| 6 | [運用設計](./プロンプト/運用設計.md) | [運用設計](./テンプレート/運用設計.md) | 運用手順設計 | 非機能要件、システム構成図 |

## フェーズ完了条件（ゲートレビュー: 設計承認）

以下の条件を満たすとPhase 4（開発・テスト）に進めます:

- [ ] **IF・DB・UIサンプル承認**: インターフェース、データベース、画面の設計が承認されている
- [ ] **要件-設計の整合性確認**: 全ての要件が設計にトレースできる
- [ ] **技術的実現可能性の確認**: 選定技術で実装可能であることが確認されている
- [ ] **性能要件の達成見込み**: 設計が性能要件を満たすことが確認されている
- [ ] **運用設計の承認**: 運用手順が明確で実行可能であることが確認されている

## 次のフェーズ

[Phase 4: テスト](../04_テスト/README.md)

## 前のフェーズ

[Phase 2: 要件定義](../02_要件定義/README.md)

## 参考資料

- [プロジェクト全体の流れ](../00_docs/全体の流れ（受託開発）.md)
- [CLAUDE.md（リポジトリ全体ガイド）](../CLAUDE.md)

## Tips

### 設計のトレーサビリティ
各設計は要件にトレースできるようにする:
```
要件（Phase 2）
  → 機能一覧
    → ユースケース
      → DB設計（エンティティ）
        → API設計（エンドポイント）
          → 画面設計（UI）
            → テストケース（Phase 4）
```

### レビューのポイント
- **機能面**: 要件を満たしているか
- **非機能面**: 性能、セキュリティ、可用性を満たしているか
- **保守性**: 将来の変更・拡張に対応できるか
- **運用性**: 運用チームが保守できるか

### ビジュアルツール推奨
- **アーキテクチャ図**: draw.io、Lucidchart、PlantUML
- **ER図**: draw.io、dbdiagram.io、PlantUML
- **API仕様**: Swagger/OpenAPI、Postman
- **画面設計**: Figma、Adobe XD、Sketch
- **フローチャート**: Mermaid、PlantUML

### 見積もり精度の向上
設計完了後、見積もりを**Medium（±30%）→ Firm（±10%）**に更新します。
